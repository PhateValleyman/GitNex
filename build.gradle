// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {

    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:7.2.1'
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
        maven { url 'https://jitpack.io' }
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}

task format {
    def proc
    // first, try `intellij-idea-ultimate-edition` as command
    try {
        proc = 'intellij-idea-ultimate-edition format -s ".idea/codeStyles/Project.xml" -m "${PLUGIN_FILE_PATTERN:-"*"}" -r .'.execute()
    } catch (ignored) {
        try {
            proc = 'intellij-idea-community-edition format -s ".idea/codeStyles/Project.xml" -m "${PLUGIN_FILE_PATTERN:-"*"}" -r .'.execute()
        } catch (ignored2) {
            println('Couldn\'t format files, IntelliJ binary is missing')
            return
        }
    }
    proc.consumeProcessOutput(System.out, System.err)
    proc.waitFor()
}
